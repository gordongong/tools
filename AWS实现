1      Amazon AWS整体架构相关问题
答：和传统集群不同，AMAZON是分布式管理，规模可以突破100万，可参考P2P方式。
问：是不是有统一的集群把这100万台都管理起来？
问：DataCenter的距离有多远，时延多大？
答：数据中心时延大概200毫秒左右。
问：S3有很多机器，一个对应一个对外IP？
答：yes
问：AMAZON的小文件如何处理？
答：有个基于内存系统进行大包，封装为大对象写入S3（该内存系统已经到上万节点），大对象的边界为1MB。
问：AMAZON内部的网络组网是否相同？  
答：AMAZON的内部网络是相同的平面，不会做自动的均衡，采用人为协调的方式的分配网络。
问：EC2启动VM和S3的关系？
答：VM的IMAGE可以存在本地CACHE，或者S3上
问：S3的BUCKET是全球唯一，那该标志存放在什么地方？  
答：这是S3上层设计，推测极有可能是在DNS上做的。
问：S3扩展到百万节点，是否有分布式锁保证并发？ 
答：对象是immutable（不可修改），不存在并发控制；对于KEYMAP的并发，采用MVCC。
问：S3的MONITOR采集是何种机制？ 
答：在本地市毫秒级的采集，然后聚合后发送给MONITOR。当S3监控到节点的可用容量小于10%时，可以Auto Scaling到新的机器了。
问：扩容是如何处理？
答：S3扩容的时间长，新加入的盘可读但是不可以写，有KEYMAP来管理哪些盘在一个组里面，所以迁移的过程中可能读的份数更多？（比如3份写入，迁移过程中可能读4份数据）。
问：EBS的IOPS如何设计？ 
答：EBS对IOPS的保证，配置上容易，但是数据平面满足该要求比较困难，可以采用混合存储介质；对于QoS的保证，亚马逊是采用预分配的方式。
亚马逊降价的原因，是在系统设计时充分考虑资源的充分利用，比如CPU利用率可以到达80%的量级。
2      云存储元数据设计机制相关问题

问：SWIFT的DHT布局管理优劣势？
答：SWIFT采用DHT算法，在上千量级的节点也许可以接受；但是在更多节点时，由于故障是常态，物理节点故障带来DHT里面的数据移动比较频繁。
问：布局寻址方法，业界做的比较好的是那种？
答：谷歌GFS里面介绍的布局不错，比较推崇，可以支持成千上万。
问：S3在寻址的方式上是DHT还是元数据记录？
答：使用的是记录，参考MetaStore。
问：S3元数据是放在一起还是分开的？
答：分开的，目前S3主要用EC (而且N+M的数值比较大)，写三份是老的版本。
问： 系统的一致性模型？
答：美国的REGION是最终一致性（因为距离的因素），而美国之外使用读写一致性。
问：KEYMAP（S3的核心部件）如何管理元数据、数据？
答：S3的元数据是immutable，数据是可以追加写的；元数据的路由管理，可以参考互联网设计（DHT是不错的选择）。
问： DHT应用局限如何改进？ 
在DHT处理中，可以用ZooKeeper的集中控制来保证稳定性。CRUSH算法在应对节点变化时，很难处理。关于数据的分布，除了DHT，也可以参考互联网的KEY VALUE STORE。
问：S3里面有VECTOR CLOCK这样的技术吗，版本如何保存？
答：S3没有使用DYNAMO的技术，VERSION时保存在KEYMAP里面的METADATA。
问：KEYMAP的树形组织深度很深，效率如何？ 
答：确实存在效率问题，比如LIST就比较慢。时延建议在100毫秒量级
3      Amazon AWS系统可靠性及数据一致性相关问题

问：发现三份不一致，大量数据检查的性能如何？
答：当前负载很大，数据检查后台处理，比如整盘扫描，频率是1月1次。
问：节点状态故障时，DYNAMO论文介绍可以用Hinted-Off来做，S3如何处理？
答：DYNAMO论文的技术，并没有落地到实际产品；写该论文的team，最后全解散了；所以，S3并未使用该技术，而是采用空间预分配方式处理。
问：EBS数据丢了，是否有方法找回？
答：有，此时对丢失数据的客户少收点钱。
问：基于NRW模型，在极限的情况下（2次故障先后发生，故障发生之间数据未完成修复）会出现数据不一致，如何设计？
答：NRW在322时是强一致性模型，你举例是2次故障的场景，可能存在数据丢失，此时可以通过增加N的分数来完成。
问：S3的METASTORE如何设计布局？
答：通过KEYMAP找到LOCATION，然后用NRW方式来读写。
问：软件对硬件可靠性的要求高，亚马逊的软件对硬件可靠性要求如何？
答：亚马逊软件就是采用通用服务器。
问：硬件部件的故障（比如NIC的故障），对系统有什么样的影响？
答：采用冗余配置、采用企业级硬盘，节点的故障可以在几十秒在百万级节点内知晓，可以采用类似GOSSIP协议。S3里面，结合了心跳和GOSSIP协议完成集群节点的管理。
问：AMAZON的Reliability为4个9，Durability为11个9？
答：Durability是数据可靠性，Reliability为数据能否访问？S3的DURABILITY比EBS高。
问：服务器有网卡故障是立即换还是等一段时间换？
答：根据11个9的Durability计算方法，参考马尔科夫链，有个时间会对该Durability产生影响，目前来看是1个月。实际上，几个月批量更换硬件，新硬件会有点灯（有利于更换）。
问：3副本放到多个数据中心，在1个数据中心故障后，是否自动修复？ 
答：故障后的修复，不用自动修复，建议手动修复；对于小错误，还是会自动修复。
问：Data Integrity Check是比较耗CPU，S3如何设计？  
答：频率不能太快，CEPH是1个月；S3是可以用线程比例来控制，比如99个线程服务1个线程做检测。
问：基于三个数据中心，如果1个数据中心故障，写业务还会继续吗？
答：从S3的场景来看，建议停止写业务。
问：reduced redundancy配置如何？ 
答：早期写3份是属于，现在EC的低配置属于；但是要满足11个9的durability是机密，但是传统的12+4肯定不满足。
问：对于磁盘故障的修复？
答：在磁盘故障时，KEYMAP STORE的METADATA STORE记录对象的可靠性级别（比如12+3的EC，在坏了2快盘就提示尽快修复）。
问：S3上次出的故障，能否分析一下?
答：不能提。（网上有报告，但细节不会披露）
4      Amazon AWS系统硬件相关问题

问：AMAZON的硬件形态如何？
答：刀片机（在外面定制），3个数据中心，机器大约100万台。
问：EBS对IO架构要求比较高，是否和S3分开？
答：底层系统不是一套，从逻辑上是分开的。
问：EBS和S3底层硬件是一样的还是不一样的？
答，应该没有区别，都差不多，都是刀片机。
问：节点数和提供服务的关系？例如，有需要的情况下，服务器使用的服务器可以共享吗？
答：通常不会，各个服务用自己的服务器；有些服务会共享EC2提供的平台，但是在逻辑上是分开的。
问：Glacier是否使用磁带？
答：Glacier使用盘，而且使用了SMR盘。
问：SMR盘使用注意情况？
答：SMR盘最适合归档场景，注意SMR盘的FIRMWARE有一定限制，比如SUSPEND
问：S3里面的机器是新旧在一起的吗？ 
答：是的，采用预分配方式来管理空间。
问：AMAZON的高密框密度如何？ 
答：可以做到4U 90盘位，此时需要考虑专门的承重。90盘的框，大约使用4个核的CPU。
问：如何看到硬盘不更换的策略？ 
答：国外机器都是租赁，3年后就归还；所以AMAZON在盘故障时也希望不更换，只做数据迁移。
5      Amazon AWS系统可维护相关问题

问：关于AMAZON大规模的集成系统，怎么升级？
答：无法一次性升级的话，就分为几次，就是旧代码和新代码都在，等新的好了，再把旧的升级；对外业务是不中断的。
问：S3如何做批量部署和升级？
答：数据中心分为不同的host class，每个host class大约100台（没有专门的计算，只会个逻辑概念）。统一host class的100台机器是并行升级，停止服务；不同class之间是顺序的升级。AMAZON的大部分错误，是由于升级导致的。通常100个节点升级会在几秒钟完成，长的升级是30分钟。升级时，可以做版本回退，可能存在多版本共存，需要人为参与修复。
问：S3的告警系统的量级？ 
答：每个服务的ALARM比较多（S3 每周要4天晚上参与处理，AUTO SCALING每周50次告警处理）。
问：AMAZON的OS升级如何？
答：AMAZON升级OS还是很新区，比如从REDHAT 4升级到REDHAT 5，大约花了1年多的时间。
问：维护情况如何？
答：大约6-7人维护1个数据中心，1个人至少几千上万台。
6      Amazon AWS系统功能特性相关问题

问：S3的认证如何做？
答：S3的认证是在外层集中做。
问：S3对象VERSION是如何处理的？
答：VERSION的所有信息都保存在S3的底层，VERSION信息用KEY名来记录。S3自定义元数据放到METADATA STORE中。
问：是否用用户访问的流程控制？  
答：有，采用专门的Service来提供；很可能在KEYMAP上设计了流控。
问：同一个对象上传新的东西如何处理，是否去重？ 
答：同一个对象再次上传，作为新对象处理，不会去重。
问：S3里面是否有重删？
答：S3里面目前没有。
问：亚马逊对容量的收费策略如何？ 
答：S3以前是按月收费，微软是按分钟。
问：S3对SLA报表如何处理？
答：S3对不同的服务提供monitor，monitor会以毫秒为量级统计，可以很容易提供报表。
7      Amazon AWS开发和集成验证相关问题

问：S3用那些语言实现？
答：C语言，Java，PHYSON，都有。
问：S3是否一套隔离的系统来做代码验证和测试？
答：没有这种测试环境，开发完毕后直接上线；先做一小部分测试（在比较低优先级的地方），几天后发现没有问题，再大规模部署。
问：问题定位的效率如何？
答：1~2周找到根因，BUG的FIX大约需要1个多月。分布式系统下，去开发工具来提高问题定位的效率很难，复现问题也不可能
8      Amazon AWS使用场景相关问题

问：有没有考虑对S3里的数据做数据分析，直接分析还是先导进去，现在做的产品，对数据分析这块是怎么看的？
答：对S3不考虑这个问题，只看存储。
问：S3的GATEWAY应用场景和情况如何？
答：GATEWAY针对的场景是中小型客户，销售情况不是很好。但是大量支持其他应用，AMAZON希望构建生态链，所以不会做DROPBOX那样的应用或者API。
问：S3的IMPORT/EXPORT是如何做？
答：每个DC有STATION，由STATION读取磁盘，本质是解决网络的问题。
 
9      Amazon AWS生态系统相关问题

问：DROPBOX的数据如何流动到S3上？ 
答：DROPBOX是S3的几个大客户，DROPBOX做了很多，在S3上只是存放数据，也没有利用AMAZON的LOAD BALANCER
问：企业应用上S3有哪些问题？
答：企业的应用移到AMAZON，没有太大的困难；但是可靠性5个9的需求，AMAZON存在风险。 公有云适合创新企业的IT租赁，但是企业达到一定规模后，企业的私有云还是有成本优势。
问：S3的API有法律保护吗？
答：AMAZON对S3的API采用防御性措施，不主动攻击专利。
10  业界方向相关问题

问：存储里面新的flash介质趋势，怎么看？
答：这是一个趋势，现在做混合存储，保存热点数据。
问：HADOOP趋势？ 
答：HADOOP的趋势，不认为HDFS能够用来做存储，它只适合给MR做数据分析；国内是基于没有可用的产品来做分布式存储，外国都不用这样用。腾云网络的产品支持POSIX的和HDFS实现时，是基于相同的基类，有不同的实现，有几百行代码的差异。
问：公有云不断降价后，我们做私有云的价值何在？ 
答：企业担心数据安全，不会放到公有云上，还会有私有云。研发内部是可以看到客户数据的，但是对外不能放。
